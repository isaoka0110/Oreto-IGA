                サンプルプログラムidle2dの解説

目次

1. 概要
2. プログラムの動作について
3. ソースコードの解説

このサンプルプログラムのポイント

* アイドルイベント処理
* アニメーション

このサンプルプログラムで紹介されている「おてがる」API

AutoGL_EnableIdleEvent
  アイドルイベント処理を有効にする。
AutoGL_SetIdleEventCallback
  アイドルイベントコールバックを設定する。
AutoGL_DrawView
  再描画コールバックを強制的にコールする。



1. 概要

サンプルプログラムidleでは、「おてがる」のアイドルイベントおよび、
アニメーション機能を紹介しています。

これまでのサンプルプログラムでは
最初に一度ビューが描画されたあとは、
ユーザーがマウスやキーボードを操作することにより、
パネルあるいはビューからのイベントが生じない限り、
再描画は行なわれませんでした。

時間依存問題を理解するために、時系列データのアニメーションは
強力な可視化手段です。
このサンプルプログラムでは、アニメーション機能を実現します。
ここでいうアニメーションとは、
まずあらかじめ各時間ステップごとのビューの画像をすべてセーブしておいて、
後でこれらを順にスクリーンに出していくのではなく、
各時間ステップごとに次々とその時間におけるオブジェクトを
実際にビュー上に描画していくことを意味します。
これは、一般にはリアルタイムアニメーションと呼ばれます。

アニメーションがはじまると、適当な時間間隔ごとにアイドルイベントが
発生し、これに応してコールバックが呼ばれます。
これにより、ユーザーがマウスやキーボードを操作しなくても、
自動的に次々とビューの画像が変化していくことになります。

また、アニメーションが行なわれている最中でも、
マウスやキーボードからのイベントは有効です。
アニメーションの途中においても、パネルから設定を変更したり、
ビューからマウスドラッグによりビューイングパラメータを変更できます。

ついでにいえば、アニメーションの応用として、
ゲームを作成することもできます。
まあ、これについては、そのうちに、また、ということで...



2. プログラムの動作について

このプログラムは、起動すると二次元のオブジェクトを表示します。
基本的には、これはサンプルプログラムのpick2dと同じです。
詳しくは、more_sample_c/pick2d.cを参照。

さて、このサンプルプログラムには、パネルを開くと一番下に
Animateというボタンがあります。
これを押すと、ビューのポリラインがランダムに動き出します。
もう一度押すと、停止します。



3. ソースコードの解説

ソースコードidle2d.cを上から眺めていきます。
基本的には、pick2d.cと同じなので、
異なるところだけを説明します。

グローバル変数のセクションに、CenterX、CenterYがあります。
これは、ポリラインの中心に関する原点からの移動オフセットです。
アニメーションが開始されると、この値がランダムに変化するため、
そのたびにポリラインの位置が移動します。

再描画コールバック関数RedrawView、
イベント処理コールバック関数HandleEventともほとんど同じです。
ただし、CenterX、CenterYを考慮しています。
また、キーボードイベントに対応し、
スペースキーを押すと端末に"HIT SPACE"というメッセージがでます。

このあと、２つのコールバック関数がでてきます。

最初のIdleEventは、アイドルイベント用のコールバックです。
この関数がコールされるたびに、CenterX、CenterYの値をランダムに書き換えて、
その後でAutoGL_DrawViewにより再描画を行ないます。

次のAnimateは、Animateボタンのコールバックであり、
ユーザーがAnimateボタンを押すとコールされます。
これはトグルスイッチであり、アニメーションの有効、無効を切替えます。
この動作は静的変数idleEventIsOnにより制御されています。
「おてがる」APIのAutoGL_SetIdleEventCallbackには、
アイドルイベント処理のためのコールバックが渡されます。
これは、void function (void)形式でなければなりません。
一方、AutoGL_SetIdleEventCallbackにNULLを渡すと、
アイドルイベント処理が無効化されます。

最後に、初期化コールバックAutoGL_SetUpですが、pick2d.cとの違いとしては、
アイドルイベント処理を有効化するために、
AutoGL_EnableIdleEventがコールされています。
これは、アイドルイベントを処理するプログラムごとに必ず、
AutoGL_SetUpの中で呼び出して下さい。
まずこうしておいてから、アイドルイベント処理自体は、
別途前述のAutoGL_SetIdleEventCallbackによりその開始、終了ができます。

また、Animateボタンに対応するAnimateコールバックが登録されてます。
