                サンプルプログラムselection3dの解説

目次

1. 概要
2. プログラムの動作について
3. ソースコードの解説

このサンプルプログラムのポイント

* 三次元アプリでの、より一般的なオブジェクト選択



1. 概要

サンプルプログラムselection3dでは、「おてがる」三次元ユーティリティの
三次元イベント処理機能を紹介しています。

サンプルプログラムpick3dとの違いは、
pick3dが直方体の頂点を選択しているのに対し、
selection3dでは、その表面を選択していることです。
ここで紹介されている「おてがる」の選択APIでは、
点や線、面、およびそれらの集合など、任意のオブジェクトを選択できます。

詳しくは、マニュアルのAPIリファレンスmanual/api_reference.txtのうち、
グラフィックスにおける選択のセクションを御覧下さい。

また、pick3dと同様、ビューでのイベント処理も関係します。
マニュアルのAPIリファレンスmanual/api_reference.txtのうち、
グラフィックスにおけるイベント処理セクションを御覧下さい。



2. プログラムの動作について

このプログラムは、起動すると三次元のオブジェクトを表示します。

画面には、直方体が表示されており、
selection3dでは、直方体を構成する６枚の表面のうち
どれか一つを選択することができます。

ここで、その表面のどれかをマウスの左ボタンでクリックしてみましょう。
それが選択されて赤くなり、
一方、端末にはメッセージが表示されます。
メッセージから、選択された表面の番号(１から開始される)が分かります。
別の表面を選択すれば、これまで選択されていたものはクリアされます。
その他の部分を選択しようとすれば、すべての選択が解除されます。

また、このサンプルプログラムは三次元アプリケーションなので、
メニューバーからPanelを表示し、移動や回転、拡大縮小ができます。
modeチョイスのモードをその他(Other)にすると、
マウスによる表面の選択ができるようになります。



3. ソースコードの解説

ソースコードselection3d.fを上から眺めていきます。

まず、メインルーチンです。

コモンブロックですが、
変数selected_face_idは、
現在選択されている表面の番号を記録しています。
選択されていれば、1から6までの整数のどれかをとり、
また、なにも選択されていなければ、-1となります。

再描画コールバックautogl_redrawでは、三次元空間の座標軸を描画し、
続いて直方体の各表面に対応する四辺形を描画します。
このとき、もしその表面が選択されていれば、赤で、
さもなくば、白で四辺形を描画します。
また、各表面の中央付近に、表面の番号を描画しています。

イベント処理コールバックautogl_handle_eventの構造は、
基本的にはサンプルプログラムのpick3dと同じです。
異なるのは、何をどのようにピックするのかです。
このサンプルプログラムでは、各表面に対応する四辺形を選択します。

なお、オブジェクト選択については、
サンプルプログラムのmore_sample_f/selection2d.fを参照。
