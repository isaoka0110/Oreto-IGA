                サンプルプログラムgraph3dの解説

目次

1. 概要
2. プログラムの動作について
3. ソースコードの解説

このサンプルプログラムのポイント

* ディスプレイリストによる高速化
* 座標系マーク

このサンプルプログラムで紹介されている「おてがる」API

autogl_open_display_list
  ディスプレイリストを開く。
autogl_close_display_list
  ディスプレイリストを閉じる。
autogl_draw_display_list
  ディスプレイリストを描画する。
autogl_draw_coordinate_system3d
  画面左下隅に三次元の座標系マークを表示する。



1. 概要

サンプルプログラムgraph3dは、二次元スカラー場の三次元グラフを表示します。
ここでいう三次元グラフとは、x、y平面に分布するスカラー量について、
z軸にそのスカラー値自体をとったプロットのことです。

このサンプルプログラムについては、
ディスプレイリストを用いていることを除いては、
わりと普通の「おてがる」アプリです。

したがってここでは、ディスプレイリストの使い方について説明します。



2. プログラムの動作について

このプログラムは、起動すると三次元グラフを表示します。

スカラー場自体はサンプルプログラムmore_sample_f/contour.fと同じなので、
説明は省略します。

三次元グラフについてですが、
曲面は白で表示されており、また鏡面反射効果(スペキュラー)がはいっています。
また、スカラー値を５倍のスケールにしたものをz座標値としています。

マウスをドラッグすると、ビューが回転します。
それ以外のモードにするには、まずメニューバーからPanelを表示し、
そのmodeチョイスボックスからモードを変更します。
なお、このサンプルプログラムはmore_sample_f/contour.fやline_contour.fと
異なり、三次元アプリケーションです。



3. ソースコードの解説

ソースコードgraph3d.fを上から眺めていきます。

スカラー値の定義はmore_sample_f/contour.fと同じです。
その他、z方向のスケール倍率として、z_scaleという変数があり、
5.0に初期化されています。

サブルーチンplot_graph3dが、三次元グラフ表示を行なうところです。
コンタープロットと同様、スカラー場が分布する差分格子を構成するすべてのセル、
つまり、この例では計一万個の四辺形について、
おのおのをz方向の高さをつけて描画しています。
さらにここでは、各四辺形を２枚の三角形として描画しています。
全体としては、三次元グラフの曲面が計２万個の三角形として表現されています。

次に、再描画コールバックautogl_redrawです。
本サンプルプログラムでは、ディスプレイリストを用いて描画を高速化しています。
このプログラムでは、プログラムの実行を通じて三次元グラフの曲面形状が
変化することはなく、主に視線方向などビューイングパラメータのみが
変化します。
このような比較的スタティックなオブジェクトを可視化する場合、
ディスプレイリストを用いると効率的です。

ディスプレイリストの作成はプログラムが起動して最初に再描画コールバックが
呼ばれたときに一度だけ行なわれます。
グローバル変数model_is_renderedによりそれを保証しています。

まず、ディスプレイリストをautogl_open_display_listにより開きます。
そこで、サブルーチンplot_graph3dがコールされているので、
plot_graph3dで描画されるすべてのもの、つまり、
２万個の三角形がディスプレイリストにいったん収納されています。
その後で、ディスプレイリストをautogl_close_display_listより閉じます。
plot_graph3dの結果は、この段階ではまだ画面にあらわれません。

その後、autogl_draw_display_listによりディスプレイリストが描画されます。
ここで初めて、画面にグラフの曲面が描画されます。

なお、ディスプレイリストは「おてがる」アプリごとに一つしか保持できないので、
これがオープンされた段階で前のディスプレイリストのデータは
消去されてしまいます。
御注意下さい。

以後は、再描画コールバックがコールされるごとに、
グローバル変数model_is_renderedにより、ディスプレイリストの変更は行なわれず、
すでに作成ずみのディスプレイリストが描画されるだけになります。

あと、画面の左下隅に三次元の座標系のマークを表示しているのが、
autogl_draw_coordinate_system3dです。
これは、三次元ユーティリティの一つです。
なお、このコールをディスプレイリストに収納してはいけません。
座標系マークの位置を画面左下に固定したいからです。
ディスプレイリストのオープンとクローズの外側で
これをコールする必要があります。
