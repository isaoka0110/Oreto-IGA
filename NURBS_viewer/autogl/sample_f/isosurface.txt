                サンプルプログラムisosurfaceの解説

目次

1. 概要
2. プログラムの動作について
3. ソースコードの解説

このサンプルプログラムのポイント

* 等値面
* コンターのグレード値に対応するRGBを得る。

このサンプルプログラムで紹介されている「おてがる」API

autogl_get_contour_color 
  コンターマップからグレード値に相当するRGBを得る。
autogl_draw_isosurface_hexahedron 
  六面体領域内部に等値面を描画する。
autogl_draw_isosurface_tetrahedron 
  四面体領域内部に等値面を描画する。
autogl_draw_box3d
  直方体の枠線を描画する。
autogl_turn_on_transparency
  半透明表示をする。



1. 概要

サンプルプログラムisosurfaceでは、「おてがる」可視化ユーティリティの
等値面機能を紹介しています。

「おてがる」可視化ユーティリティは、二次元あるいは三次元における
さまざまな物理量の可視化に関する機能を実現しています。

例えば、三次元空間のある領域内のスカラー場について、
これを等値面表示することは、
スカラー場の可視化手段としてよく行なわれることです。
本サンプルプログラムは、この等値面表示を実現するための
デモプログラムです。



2. プログラムの動作について

このプログラムは、起動すると等値面図を表示します。

等値面表示の対象となるスカラー場は、三次元の40 x 40 x 40で分割された
直交差分格子上に分布するものです。
このプログラムでは、x、y、zに関する適当なスカラー関数を利用して
このスカラー場を生成していますが、これをファイルから読み込むなどすれば、
等値面表示のためのビューアとして使うことができるようになります。

このスカラー場の等値面表示では、3枚の等値面を抽出し、
これらの等値面をそれぞれコンターに対応する色で描画しています。
それぞれの色に対応するスカラー値は、中心値が2.0で幅を2.0としたときの3つの値、
すなわち、0.0(青), 2.0(黄色), 4.0(赤)に対応します。
なお、等値面は半透明表示されています。

マウスをドラッグすると、ビューが回転します。
それ以外のモードにするには、まずメニューバーからPanelを表示し、
そのmodeチョイスボックスからモードを変更します。
なお、このサンプルプログラムは三次元アプリケーションです。
移動、回転および拡大縮小ができます。



3. ソースコードの解説

ソースコードisosurface.fを上から眺めていきます。

まず、メインルーチンです。

コモンブロックですが、
スカラー値に関するグローバル変数grid_valuesが定義されています。
この変数は、x、y、z方向にそれぞれCELLS (=40) 分割した直交差分格子にある、
(CELLS + 1) x (CELLS + 1) x (CELLS + 1)の各格子点上のスカラー値を表現します。

その次に、コンター表示の最大値、最小値を表わす変数min_range、max_rangeが
定義されています。

また、等値面の中心値はlevel_value(＝2.0)、幅はlevel_width(＝2.0)となっています。

そのあと、スカラー場を表現する変数grid_valuesについて、
これを適当にでっちあげたx、y、zに関するスカラー関数で初期化しています。

さて、サブルーチンplot_isosurface_of_levelが、等値面表示を行なうところです。
この関数は、スカラー場から引数valueという等値面のレベル値に相当する
等値面を抽出し、これを描画します。
ここにあるように、等値面表示は、このスカラー場が分布する差分格子を
構成するすべてのセル、つまり、この例では計6万4千個の六面体について、
等値面を構成する三角形群を切出し、これらを描画していくことで生成されます。

まず、等値面のレベル値に対応するグレード値gradeを計算し、
次にコンターマップにおいてこのgradeに対応するRGBの三色を、
「おてがる」のautogl_get_contour_colorにより評価し、
これを現在の色として設定します。

各セルの等値面描画は、
「おてがる」のautogl_draw_isosurface_hexahedronによってなされます。
これは、「おてがる」の可視化ユーティリティに所属し、
六面体の内部に等値面を描画するものです。

autogl_draw_isosurface_hexahedronの引数は、
順に、最小値、最大値、コンターの段数、
および、六面体の各頂点ごとに、x、y、z座標とスカラーの値を並べます。
ただし、ここでは等値面を一枚だけ表示しているので、
最大値と最小値は同じ値で、引数として渡されている等値面のレベル値となっており、
コンターの段数は0としています。
ちなみに、四面体の場合は、
autogl_draw_isosurface_tetrahedronとなります。
詳しくは、マニュアルのAPIリファレンスmanual/api_reference.txtのうち、

可視化ユーティリティのセクションを御覧下さい。

等値面の他に、断面コンター表示もできます。
これについては、サンプルプログラムのmore_sample_f/section.fを参照。

次に、サブルーチンplot_isosurfaceでは、3つの異なるレベル値を用いて
上のplot_isosurface_of_levelをコールしています。

その後が、再描画コールバックautogl_redrawです。
本サンプルプログラムでは、ディスプレイリストを用いて描画を高速化しています。
これについては、サンプルプログラムのmore_sample_f/graph3d.fに
より詳しい説明があります。
このプログラムでは、サブルーチンplot_isosurfaceで描画されるすべてのものが
ディスプレイリストにいったん収納されています。

ちなみに、autogl_draw_box3dは直方体の枠線を描画します。
ここでは、枠線はスカラー場である直交差分格子の範囲を意味しています。

また、autogl_turn_on_transparencyによって、半透明効果が有効になっています。
