                サンプルプログラムidle2dの解説

目次

1. 概要
2. プログラムの動作について
3. ソースコードの解説

このサンプルプログラムのポイント

* アイドルイベント処理
* アニメーション

このサンプルプログラムで紹介されている「おてがる」コールバックサブルーチン

autogl_idle
  「おてがる」のアイドルイベント処理コールバックサブルーチン。
  ユーザープログラム側にこの名前で必ず一つだけ存在しなければならない。

このサンプルプログラムで紹介されている「おてがる」API

autogl_enable_idle_event
  アイドルイベント処理を有効にする。
autogl_set_idle_event_callback
  アイドルイベントコールバックを設定する。
autogl_draw_view
  再描画コールバックを強制的にコールする。



1. 概要

サンプルプログラムidleでは、「おてがる」のアイドルイベントおよび、
アニメーション機能を紹介しています。

これまでのサンプルプログラムでは
最初に一度ビューが描画されたあとは、
ユーザーがマウスやキーボードを操作することにより、
パネルあるいはビューからのイベントが生じない限り、
再描画は行なわれませんでした。

時間依存問題を理解するために、時系列データのアニメーションは
強力な可視化手段です。
このサンプルプログラムでは、アニメーション機能を実現します。
ここでいうアニメーションとは、
まずあらかじめ各時間ステップごとのビューの画像をすべてセーブしておいて、
後でこれらを順にスクリーンに出していくのではなく、
各時間ステップごとに次々とその時間におけるオブジェクトを
実際にビュー上に描画していくことを意味します。
これは、一般にはリアルタイムアニメーションと呼ばれます。

アニメーションがはじまると、適当な時間間隔ごとにアイドルイベントが
発生し、これに応してコールバックが呼ばれます。
これにより、ユーザーがマウスやキーボードを操作しなくても、
自動的に次々とビューの画像が変化していくことになります。

また、アニメーションが行なわれている最中でも、
マウスやキーボードからのイベントは有効です。
アニメーションの途中においても、パネルから設定を変更したり、
ビューからマウスドラッグによりビューイングパラメータを変更できます。

ついでにいえば、アニメーションの応用として、
ゲームを作成することもできます。
まあ、これについては、そのうちに、また、ということで...



2. プログラムの動作について

このプログラムは、起動すると二次元のオブジェクトを表示します。
基本的には、これはサンプルプログラムのpick2dと同じです。
詳しくは、more_sample_f/pick2d.fを参照。

さて、このサンプルプログラムには、パネルを開くと一番下に
Animateというボタンがあります。
これを押すと、ビューのポリラインが動き出します。
もう一度押すと、停止します。



3. ソースコードの解説

ソースコードidle2d.fを上から眺めていきます。
基本的には、pick2d.fと同じなので、
異なるところだけを説明します。

最初に、メインルーチンですが、pick2d.fとの違いとしては、
アイドルイベント処理を有効化するために、
autogl_enable_idle_eventがコールされています。
これは、アイドルイベントを処理するプログラムごとに必ず、
メインルーチンの中で呼び出して下さい。
まずこうしておいてから、アイドルイベント処理自体は、
別途前述のautogl_set_idle_event_callbackによりその開始、終了ができます。

また、Animateボタンに対応するサブルーチンはanimate_buttonです。

あと、コモンブロックに、center_x、center_yがあります。
これは、ポリラインの中心に関する原点からの移動オフセットです。
アニメーションが開始されると、この値がランダムに変化するため、
そのたびにポリラインの位置が移動します。

再描画コールバックautogl_redraw、
イベント処理コールバックautogl_handle_eventともほとんど同じです。
ただし、center_x、center_yを考慮しています。

このあと、２つのコールバックサブルーチンがでてきます。

最初のautogl_idleは、アイドルイベント用のコールバックです。
このサブルーチンがコールされるたびに、
center_x、center_yの値をランダムに書き換えて、
その後でautogl_draw_viewにより再描画を行ないます。

次のanimate_buttonは、Animateボタンに対応するサブルーチンであり、
ユーザーがAnimateボタンを押すとコールされます。
これはトグルスイッチであり、アニメーションの有効、無効を切替えます。
この動作はコモンブロックの静的変数idle_event_is_onにより制御されています。
「おてがる」APIのautogl_set_idle_event_callbackをコールする際に、
引数に1を渡すと、アイドルイベント処理のためのコールバックが設定されます。
一方、0を渡すと、アイドルイベント処理が無効化されます。

